% To create PNGs invoke
%
%   pdflatex -shell-escape example-QuantumGates-Eqn.tex
%
% Windows: Needs ImageMagick to convert pdf to png!
%
%\documentclass{standalone}
%\documentclass[multi={tikzpicture,math}]{standalone}
\documentclass[multi={tikzpicture,math},convert={convertexe={convert},density=120}]{standalone}
\usepackage{amsmath}
\usepackage{xcolor}
%\usepackage{tikz-quantumgates} % @ https://rawgit.com/matthias-wolff/tikz-quantumgates/master/tikz-quantumgates.sty
\usepackage{../../../../btu/Publish/LaTeX/tikz-quantumgates/tikz-quantumgates}

\begin{document}
% %% -- 0 -----------------------------------------------------------------------
% \begin{tikzpicture}
%   \qgateID[ibmqx]{0}{0}
% \end{tikzpicture}
% %% -- 1 -----------------------------------------------------------------------
% \begin{tikzpicture}
%   \qwire[ibmqx]{0}{0}
% \end{tikzpicture}
% %% -- 2 -----------------------------------------------------------------------
% \begin{tikzpicture}
%   \qgateX[ibmqx]{0}{0}
% \end{tikzpicture}
% %% -- 3 -----------------------------------------------------------------------
% \begin{tikzpicture}
%   \qgateY[ibmqx]{0}{0}
% \end{tikzpicture}
% %% -- 4 -----------------------------------------------------------------------
% \begin{tikzpicture}
%   \qgateZ[ibmqx]{0}{0}
% \end{tikzpicture}
% %% -- 5 -----------------------------------------------------------------------
% \begin{tikzpicture}
%   \qgateH[ibmqx]{0}{0}
% \end{tikzpicture}
% %% -- 6 -----------------------------------------------------------------------
% \begin{tikzpicture}
%   \qgateS[ibmqx]{0}{0}
% \end{tikzpicture}
% %% -- 7 -----------------------------------------------------------------------
% \begin{tikzpicture}
%   \qgateSi[ibmqx]{0}{0}
% \end{tikzpicture}
% %% -- 8 -----------------------------------------------------------------------
% \begin{tikzpicture}
%   \qgateT[ibmqx]{0}{0}
% \end{tikzpicture}
% %% -- 9 -----------------------------------------------------------------------
% \begin{tikzpicture}
%   \qgateTi[ibmqx]{0}{0}
% \end{tikzpicture}
% %% -- 10 ----------------------------------------------------------------------
% \begin{tikzpicture}
%   \qgateUa[ibmqx]{0}{0}
% \end{tikzpicture}
% %% -- 11 ----------------------------------------------------------------------
% \begin{tikzpicture}
%   \qgateUb[ibmqx]{0}{0}
% \end{tikzpicture}
% %% -- 12 ----------------------------------------------------------------------
% \begin{tikzpicture}
%   \qgateUc[ibmqx]{0}{0}
% \end{tikzpicture}
% %% -- 13 ----------------------------------------------------------------------
% \begin{tikzpicture}
%   \qgateCNX[ibmqx]{b}{0}{1}; \node[anchor=east] at (-0.6,1) {$q[0]$};
%   \qgateCNC[ibmqx]{t}{0}{0}; \node[anchor=east] at (-0.6,0) {$q[1]$};
% \end{tikzpicture}
% %% -- 14 ----------------------------------------------------------------------
% \begin{tikzpicture}
%   \qgateCNC[ibmqx]{b}{0}{1}; \node[anchor=east] at (-0.6,1) {$q[0]$};
%   \qgateCNX[ibmqx]{t}{0}{0}; \node[anchor=east] at (-0.6,0) {$q[1]$};
% \end{tikzpicture}
% %% -- 14 ----------------------------------------------------------------------
% \begin{tikzpicture}
%   \qgateCNC[ibmqx]{b}{0}{2}; \node[anchor=east] at (-0.6,2) {$q[0]$};
%   \qgateCNR[ibmqx]   {0}{1}; \node[anchor=east] at (-0.6,1) {$q[1]$};
%   \qgateCNX[ibmqx]{t}{0}{0}; \node[anchor=east] at (-0.6,0) {$q[2]$};
% \end{tikzpicture}
% %% -- 15 ----------------------------------------------------------------------
% \begin{tikzpicture}
%   \qgateCNC[ibmqx]{b }{0}{2}; \node[anchor=east] at (-0.6,2) {$q[0]$};
%   \qgateCNC[ibmqx]{bt}{0}{1}; \node[anchor=east] at (-0.6,1) {$q[1]$};
%   \qgateCNX[ibmqx]{t }{0}{0}; \node[anchor=east] at (-0.6,0) {$q[2]$};
% \end{tikzpicture}
%% -- 16 ----------------------------------------------------------------------
\begin{tikzpicture}
  \definecolor{dkgreen}{HTML}{006600}
  \def\setslot#1{\pgfmathsetmacro\x{#1}}
  \def\prevslot{\pgfmathsetmacro\x{(\x-1)}}
  \def\I#1{\qwire[ibmqx]{\x}{#1}}
  \def\H#1{\qgateH[ibmqx]{\x}{#1}}
  \def\T#1{\qgateT[ibmqx]{\x}{#1}}
  \def\Ti#1{\qgateTi[ibmqx]{\x}{#1}}
  \def\CNOTa{% = \CNOTa
    \qwire[ibmqx]{\x}{3}%
    \qgateCNC[ibmqx]{b}{\x}{2}%
    \qgateCNX[ibmqx]{t}{\x}{1}%
  }
  \def\CNOTb{% = CNOT302
    \qgateCNC[ibmqx]{b}{\x}{3}%
    \qgateCNR[ibmqx]{\x}{2}%
    \qgateCNX[ibmqx]{t}{\x}{1}%
  }  
  % Quantum circuit
  \setslot{23}
  \CNOTa              \prevslot  % slot 23
  \H{1}  \H{2}  \I{3} \prevslot  % slot 22
  \CNOTa              \prevslot  % slot 21
  \H{1}  \H{2}  \I{3} \prevslot  % slot 20
  \CNOTa              \prevslot  % slot 19
  \CNOTb              \prevslot  % slot 18
  \Ti{1} \I{2}  \T{3} \prevslot  % slot 17
  \CNOTb              \prevslot  % slot 16
  \CNOTa              \prevslot  % slot 15
  \H{1}  \H{2}  \I{3} \prevslot  % slot 14
  \CNOTa              \prevslot  % slot 13
  \H{1}  \H{2}  \I{3} \prevslot  % slot 12
  \CNOTa              \prevslot  % slot 11
  \H{1}  \I{2}  \I{3} \prevslot  % slot 10
  \T{1}  \T{2}  \I{3} \prevslot  % slot 9
  \CNOTb              \prevslot  % slot 8
  \Ti{1} \I{2}  \I{3} \prevslot  % slot 7
  \CNOTa              \prevslot  % slot 6
  \T{1}  \I{2}  \I{3} \prevslot  % slot 5
  \CNOTb              \prevslot  % slot 4
  \Ti{1} \I{2}  \I{3} \prevslot  % slot 3
  \CNOTa              \prevslot  % slot 2
  \H{1}  \I{2}  \I{3} \prevslot  % slot 1
  % Annotations
  \node[anchor=west] at (-0.1,3) {q[0]}; 
  \node[anchor=west] at (-0.1,2) {q[1]}; 
  \node[anchor=west] at (-0.1,1) {q[2]}; 
  \node[anchor=west,color=dkgreen] at (-0.1,0) {\sf slot}; 
  \foreach \x in {1,...,23} {%
    \node[color=dkgreen] at (\qgateSx*\x,0) {\sf\x};
  }
  \draw[very thick, dkgreen] (0.6*\qgateSx,3.4) -- (0.6*\qgateSx,3.7) -- 
    (18.4*\qgateSx,3.7) -- (18.4*\qgateSx,3.4);
  \node[dkgreen] at (9.5*\qgateSx,4) 
    {\sf Toffoli gate with flips (see IBM QX tutorials)}; 
  \draw[very thick, dkgreen] (18.6*\qgateSx,3.4) -- (18.6*\qgateSx,3.7) -- 
    (23.4*\qgateSx,3.7) -- (23.4*\qgateSx,3.4); 
  \node[dkgreen] at (21*\qgateSx,4) 
    {\sf swap $q[1]$ and $q[2]$)}; 
\end{tikzpicture}

%   \node[anchor=west] at (-1.3,3) {q[0]}; 
%   \node[anchor=west] at (-1.3,2) {q[1]}; 
%   \node[anchor=west] at (-1.3,1) {q[2]}; 
%   \node[anchor=west] at (-1.2,0) {c}; 
%   % - Preparations
%   \setslot{0}
%   \qzero[ibmqx]{\x}{1}\qzero[ibmqx]{\x}{2}\qzero[ibmqx]{\x}{3}\qmeasBh[ibmqx]{3}{\x}{0}


\end{document}